# Task Queue for Ralph Loop
# Auto-generated by /bmad:sprint-planning
#
# Ralph Loop reads this file to:
# - Find next available task
# - Track progress
# - Resume after interruption

version: "1.0"
project: "{{project_name}}"
sprint: {{sprint_number}}
created_at: "{{date}}"

summary:
  total_stories: {{story_count}}
  total_tasks: {{task_count}}
  estimated_hours: {{hours}}
  completed_tasks: 0
  blocked_tasks: 0

# Current task being executed (set by Ralph)
current_task: null

# Task state machine:
# PENDING → IN_PROGRESS → VERIFYING → DONE
#              ↓            ↓
#           RETRYING ← ────┘ (on failure)
#              ↓
#           BLOCKED (max_retries exceeded)

tasks:
  # === STORY-001: {{story_title}} ===

  # Schema/Types first
  - id: "TASK-001-A"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "backend"  # api | backend | frontend | test | devops
    estimated_minutes: 30  # MAX 60 minutes!
    status: "pending"  # pending | in_progress | verifying | done | blocked
    depends_on: []
    outputs:
      - "{{file_path}}"
    acceptance:
      - "{{criterion_1}}"
      - "{{criterion_2}}"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

  # API spec
  - id: "TASK-001-B"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "api"
    estimated_minutes: 30
    status: "pending"
    depends_on: ["TASK-001-A"]
    outputs:
      - "openapi.yaml"
    acceptance:
      - "{{criterion_1}}"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

  # Backend implementation
  - id: "TASK-001-C"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "backend"
    estimated_minutes: 45
    status: "pending"
    depends_on: ["TASK-001-A", "TASK-001-B"]
    outputs:
      - "backend/src/features/{{feature}}/{{slice}}/controller.ts"
      - "backend/src/features/{{feature}}/{{slice}}/dto.ts"
    acceptance:
      - "{{criterion_1}}"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

  - id: "TASK-001-D"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "backend"
    estimated_minutes: 45
    status: "pending"
    depends_on: ["TASK-001-C"]
    outputs:
      - "backend/src/features/{{feature}}/{{slice}}/service.ts"
    acceptance:
      - "{{criterion_1}}"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

  # Frontend implementation
  - id: "TASK-001-E"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "frontend"
    estimated_minutes: 45
    status: "pending"
    depends_on: ["TASK-001-D"]  # Backend done first
    outputs:
      - "frontend/src/{{layer}}/{{slice}}/ui/{{Component}}.tsx"
    acceptance:
      - "{{criterion_1}}"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

  # Tests
  - id: "TASK-001-F"
    story_id: "STORY-001"
    title: "{{task_title}}"
    type: "test"
    estimated_minutes: 60
    status: "pending"
    depends_on: ["TASK-001-D", "TASK-001-E"]  # After implementation
    outputs:
      - "backend/src/features/{{feature}}/{{slice}}/*.test.ts"
      - "frontend/src/{{layer}}/{{slice}}/**/*.test.tsx"
    acceptance:
      - "Coverage >= 80%"
      - "All tests passing"
    retries: 0
    max_retries: 3
    started_at: null
    completed_at: null
    error: null

# === Limits for Ralph Loop ===
limits:
  per_task: 5       # Max iterations per single task
  per_story: 30     # Max tasks per story
  per_session: 100  # Max tasks per session
