---
name: step3-prd
description: "Шаг 3: PRD документ. Используй: 'prd', 'требования', 'product requirements', 'step3'"
allowed-tools: [Read, Write, Edit, Glob, TodoWrite, AskUserQuestion]
---

# Шаг 3: Product Requirements Document

Детальный документ требований к продукту.

## Что это?

PRD (Product Requirements Document) — полная спецификация продукта:
- Детальные user stories
- Функциональные требования
- Нефункциональные требования
- Acceptance criteria для каждой фичи

## Когда использовать?

После `/step2-brief`, перед `/step4-arch`.

## Как запустить?

```bash
/step3-prd
```

## Что получим?

Документ `docs/prd-{project}-{date}.md` с:

---

## MANDATORY INTERVIEW PROCESS

**CRITICAL — ЗАДАЙ ВСЕ ВОПРОСЫ ПОСЛЕДОВАТЕЛЬНО**

Используй AskUserQuestion tool для КАЖДОГО вопроса. НЕ ПРОПУСКАЙ вопросы. НЕ генерируй документ пока не получишь ответы на ВСЕ вопросы.

### Секция 1: Обзор продукта (3 вопроса)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Vision statement**
   ```
   В одном предложении: что это за продукт и какую ценность несет?
   Формат: "[Продукт] помогает [кому] [делать что] чтобы [результат]"
   ```

2. **Цели продукта**
   ```
   Какие 3-5 главных целей мы хотим достичь этим продуктом?
   Примеры: "Увеличить retention на 20%", "Снизить time-to-value с 1 часа до 5 минут"
   ```

3. **Ключевые метрики**
   ```
   По каким метрикам будем измерять успех продукта?
   Примеры: MAU, conversion rate, NPS, retention D7/D30, LTV/CAC
   ```

**После получения ответов проверь качество:**
- Если vision > 30 слов → спроси: "Можешь короче?"
- Если цели абстрактны → спроси: "Как измерим достижение?"
- Если < 3 метрик → спроси: "Какие еще важны?"

---

### Секция 2: User Stories (4 вопроса)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Основные user stories**
   ```
   Перечисли 5-10 основных user stories в формате:
   "Как [роль], я хочу [действие], чтобы [результат]"

   Пример: "Как менеджер проекта, я хочу создать задачу одним кликом, чтобы не тратить время на формы"
   ```

2. **Приоритизация stories**
   ```
   Какие из этих stories критичны для первого релиза (P0)?
   Какие важны, но можно отложить (P1)?
   Какие nice-to-have (P2)?
   ```

3. **Зависимости между stories**
   ```
   Есть ли stories, которые зависят друг от друга?
   Какие должны быть реализованы первыми?
   ```

4. **Граничные случаи**
   ```
   Какие edge cases нужно учесть?
   Примеры: оффлайн режим, медленный интернет, большой объем данных
   ```

**После получения ответов проверь качество:**
- Если stories не в формате "Как [роль]..." → спроси: "Переформулируй в правильном формате"
- Если > 5 P0 stories → спроси: "Точно все критичны для первого релиза?"
- Если нет зависимостей → спроси: "Точно все stories независимы?"

---

### Секция 3: Функциональные требования (5 вопросов)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Аутентификация и авторизация**
   ```
   Как пользователи будут входить? Email/password, OAuth (Google, Facebook), SSO?
   Какие роли? (Admin, User, Guest)
   Какие права у каждой роли?
   ```

2. **Основные фичи**
   ```
   Для каждой P0 story опиши детально:
   - Какие поля/данные нужны?
   - Какие действия доступны?
   - Какие ограничения? (лимиты, валидация)
   ```

3. **Интеграции**
   ```
   Нужны ли интеграции с внешними сервисами?
   Примеры: платежи (Stripe), email (SendGrid), хранилище (S3), аналитика
   ```

4. **Данные и их жизненный цикл**
   ```
   Какие основные сущности? (User, Product, Order)
   Как они связаны?
   Кто может создавать/читать/обновлять/удалять?
   ```

5. **UI/UX требования**
   ```
   Есть ли конкретные требования к интерфейсу?
   Примеры: мобильная версия обязательна, темная тема, accessibility WCAG 2.1 AA
   ```

**После получения ответов проверь качество:**
- Если нет деталей по фичам → спроси: "Какие конкретно поля нужны?"
- Если интеграций > 5 → спроси: "Какие критичны для MVP?"
- Если нет CRUD описания → спроси: "Кто может удалять/редактировать?"

---

### Секция 4: Нефункциональные требования (6 вопросов)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Performance**
   ```
   - Какое максимальное время ответа API? (например: 95-й перцентиль < 200ms)
   - Сколько запросов в секунду должна выдерживать система?
   - Размер данных? (сколько записей в БД через год)
   ```

2. **Security**
   ```
   - Какие данные критичны? (PII, финансы, медицинские)
   - Нужно ли шифрование в покое? В передаче?
   - Compliance requirements? (GDPR, HIPAA, PCI-DSS)
   ```

3. **Scalability**
   ```
   - Сколько пользователей одновременно на старте?
   - Сколько через 6-12 месяцев?
   - Горизонтальное или вертикальное масштабирование?
   ```

4. **Availability & Reliability**
   ```
   - Какой SLA нужен? (99.9% = ~8ч downtime/год)
   - Нужен failover, multi-region?
   - RPO/RTO для disaster recovery?
   ```

5. **Monitoring & Observability**
   ```
   - Какие метрики мониторить? (latency, errors, throughput)
   - Нужны ли алерты? На что?
   - Логирование: что логировать, как долго хранить?
   ```

6. **Accessibility**
   ```
   - Уровень WCAG? (A, AA, AAA)
   - Screen reader support?
   - Keyboard navigation?
   ```

**После получения ответов проверь качество:**
- Если нет конкретных чисел → спроси: "Назови конкретные значения"
- Если требования нереалистичны → спроси: "Это критично для MVP?"
- Если нет monitoring → спроси: "Как будем знать что система работает?"

---

### Секция 5: Acceptance Criteria (2 вопроса)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Acceptance criteria для P0 stories**
   ```
   Для каждой P0 story напиши acceptance criteria в формате:

   Given [предусловие]
   When [действие]
   Then [ожидаемый результат]

   Пример:
   Given пользователь на странице логина
   When вводит валидный email и password
   Then он переходит на дашборд и видит приветствие
   ```

2. **Критерии качества**
   ```
   Какие общие критерии качества для всех фич?
   Примеры:
   - Zero TS errors
   - Test coverage >= 80%
   - Все формы с валидацией
   - Responsive design (mobile + desktop)
   ```

**После получения ответов проверь качество:**
- Если acceptance criteria нет → спроси: "Как поймем что фича работает правильно?"
- Если нет Given/When/Then → спроси: "Переформулируй в формате Given/When/Then"

---

### Секция 6: Риски и допущения (3 вопроса)

**ОБЯЗАТЕЛЬНО задай ЭТИ вопросы:**

1. **Технические риски**
   ```
   Какие технические сложности можешь предвидеть?
   Примеры: сложная интеграция, производительность БД, масштабирование real-time
   ```

2. **Допущения**
   ```
   Какие допущения мы делаем?
   Примеры: "пользователи имеют стабильный интернет", "мобильные пользователи < 10%"
   ```

3. **Зависимости от третьих сторон**
   ```
   От каких внешних сервисов зависим?
   Что будет если они недоступны?
   Нужен ли fallback?
   ```

**После получения ответов проверь качество:**
- Если нет рисков → спроси: "Точно нет технических сложностей?"
- Если допущения критичны → спроси: "Что если допущение не выполнится?"

---

## Answer Quality Gates

После КАЖДОГО ответа пользователя проверь качество:

| Проблема ответа | Уточняющий вопрос |
|-----------------|-------------------|
| User story без формата "Как [роль]..." | "Переформулируй в правильном формате" |
| Нет конкретных чисел (NFR) | "Назови конкретные значения" |
| Acceptance criteria без Given/When/Then | "Используй формат Given/When/Then" |
| > 5 P0 stories | "Точно все критичны для MVP?" |
| Нет деталей по фиче | "Какие конкретно поля/действия?" |
| Нет мониторинга | "Как узнаем что система работает?" |

**ПРАВИЛО**: Если ответ попадает в таблицу — НЕМЕДЛЕННО задай уточняющий вопрос. НЕ ПЕРЕХОДИ к следующему вопросу.

---

## Context Management

Веди контекст ВСЕХ ответов в памяти:

**После КАЖДОГО ответа пользователя:**

1. **Подтверди получение:**
   ```
   ✅ Записал: [краткое извлечение]
   Переходим к следующему вопросу...
   ```

2. **Перед финальной генерацией покажи ПОЛНЫЙ summary:**
   ```
   ## Собранная информация

   ### 1. Обзор продукта
   - Vision: [ответ]
   - Цели: [список]
   - Метрики: [список]

   ### 2. User Stories (P0)
   - [story 1]
   - [story 2]
   ...

   ### 3. NFR
   - Performance: [требования]
   - Security: [требования]
   ...

   Всё верно? Могу генерировать PRD.
   ```

**КРИТИЧНО**: НЕ используй Write/Edit ДО финальной генерации. Храни всё в памяти/контексте.

---

## Pre-Generation Checklist

**БЛОКИРУЮЩЕЕ ПРАВИЛО**: НЕ генерируй документ, пока НЕ выполнены все проверки:

- [ ] Все 6 секций опрошены (23 вопроса минимум)
- [ ] Есть минимум 5 user stories
- [ ] P0 stories имеют acceptance criteria
- [ ] NFR содержат конкретные числа
- [ ] Есть мониторинг/логирование план
- [ ] Пользователь подтвердил финальный summary

**Если хоть один пункт НЕ выполнен:**
→ Покажи пользователю что не хватает
→ Спроси недостающие вопросы
→ НЕ генерируй документ

**Только когда ВСЕ пункты ✅:**
→ Переходи к секции "Call BMAD Backend" ниже

---

## Call BMAD Backend

После сбора всех 23 ответов, передай их в BMAD систему для генерации PRD.

### Шаг 1: Создай YAML файл с ответами

Создай файл `/tmp/step3-answers.yaml` со всеми собранными ответами:

```yaml
# Metadata
collected_at: "{current_timestamp_ISO8601}"
collected_by: "step3-prd"

# Section 1: Обзор продукта
product_overview: "{ответ_что_строим}"
target_users: "{ответ_для_кого}"
key_differentiators: "{ответ_чем_отличаемся}"

# Section 2: User Stories (formatted text)
user_stories: |
  US-001: Как [роль], я хочу [действие], чтобы [результат]
  US-002: Как [роль], я хочу [действие], чтобы [результат]
  US-003: ...

# Section 3: Functional Requirements (formatted text)
functional_requirements: |
  FR-001: {название}
  Priority: Must Have
  Description: {описание}
  Acceptance Criteria:
  - [ ] {критерий 1}
  - [ ] {критерий 2}

  FR-002: {название}
  ...

# Section 4: Non-Functional Requirements
nfr_performance: "{требования производительности с числами}"
nfr_security: "{требования безопасности}"
nfr_scalability: "{требования масштабируемости}"
nfr_availability: "{требования доступности (uptime SLA)}"
nfr_usability: "{требования юзабилити}"
nfr_maintainability: "{требования поддерживаемости}"

# Section 5: Epics (formatted text)
epics: |
  EPIC-001: {название}
  Stories: {список stories}
  Priority: Must Have
  Estimate: {story points}

  EPIC-002: ...

# Section 6: Acceptance Criteria (global)
acceptance_criteria: |
  AC-001: {глобальный критерий 1}
  AC-002: {глобальный критерий 2}
  ...

# Section 7: Риски
risks_technical: "{технические риски}"
risks_business: "{бизнес-риски}"
risks_timeline: "{риски сроков}"

# Section 8: Допущения
assumptions: |
  - {допущение 1}
  - {допущение 2}
  ...

# Section 9: Out of Scope
out_of_scope: |
  - {что НЕ входит 1}
  - {что НЕ входит 2}
  ...
```

**Используй Write tool для создания этого файла.**

### Шаг 2: Вызови variable-bridge.sh

```bash
bash ~/.claude/skills/bmad/bmad-v6/utils/variable-bridge.sh \
  prd \
  /tmp/step3-answers.yaml
```

**Что происходит:**
1. variable-bridge.sh загружает YAML
2. Экспортирует все 23 переменные как BMAD_*
3. Устанавливает BMAD_BATCH_MODE=true
4. Вызывает команду /prd

**Результат:**
- Команда prd использует BMAD_* переменные
- Загружает template из `~/.claude/config/bmad/templates/prd.md`
- Подставляет переменные
- Генерирует документ `docs/prd-{project}-{date}.md`
- Обновляет workflow status

### Шаг 3: Сообщи пользователю

```
✓ PRD создан!

Документ: docs/prd-{project}-{date}.md

Следующий шаг: /step4-arch
```

---

### 1. Обзор продукта
- Vision statement
- Цели продукта
- Ключевые метрики

### 2. User Stories
```
Как [роль], я хочу [действие], чтобы [результат]
```

### 3. Функциональные требования
- Группировка по фичам
- Приоритеты (P0 / P1 / P2)
- Зависимости

### 4. Нефункциональные требования
- Performance (время ответа, RPS)
- Security (аутентификация, авторизация)
- Scalability (сколько пользователей)
- Accessibility (WCAG уровень)

### 5. Acceptance Criteria
Для каждой story:
```
Given [предусловие]
When [действие]
Then [результат]
```

### 6. Риски и допущения

## Советы

- Каждая story должна быть независимой
- P0 = блокер релиза, P1 = важно, P2 = nice to have
- Acceptance criteria — это будущие тесты
- Не перегружай P0, реально оцени scope

## Следующий шаг

После PRD переходи к архитектуре:

```
/step4-arch
```
